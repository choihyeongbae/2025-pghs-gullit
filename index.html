<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“¢ì–´ë¦°ì´ êµí†µì‚¬ê³  ì•ˆì „ë„ ë¶„ì„</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.8/dist/web/static/pretendard.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: "Pretendard Variable", Pretendard, -apple-system, BlinkMacSystemFont, system-ui, Roboto, "Helvetica Neue", "Segoe UI", "Apple SD Gothic Neo", "Noto Sans KR", "Malgun Gothic", "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", sans-serif;
            background-color: #F3F4F6;
        }
        .sidebar-gradient {
            background: linear-gradient(180deg, #FFFFFF 0%, #F9FAFB 100%);
        }
        .card-shadow {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
        }
        .glass-header {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
        }
        .custom-table th {
            font-weight: 600;
            color: #6B7280;
            padding: 12px 16px;
            text-align: left;
            font-size: 0.875rem;
            border-bottom: 1px solid #F3F4F6;
        }
        .custom-table td {
            padding: 12px 16px;
            color: #374151;
            font-size: 0.875rem;
            border-bottom: 1px solid #F9FAFB;
        }
        .custom-table tr:last-child td {
            border-bottom: none;
        }
        .custom-table tbody tr:hover {
            background-color: #F9FAFB;
        }
    </style>
</head>
<body class="text-gray-800 h-screen flex overflow-hidden">

    <!-- ì‚¬ì´ë“œë°” -->
    <aside class="w-72 sidebar-gradient border-r border-gray-200 flex flex-col h-full hidden md:flex z-10">
        <div class="p-6 border-b border-gray-100">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-indigo-600 rounded-xl flex items-center justify-center text-white text-xl shadow-lg shadow-indigo-200">
                    ğŸš¦
                </div>
                <div>
                    <h1 class="font-bold text-gray-900 text-lg leading-tight">êµí†µì•ˆì „<br>ë¶„ì„ ì‹œìŠ¤í…œ</h1>
                </div>
            </div>
        </div>

        <div class="p-6 flex-1 overflow-y-auto">
            <div class="mb-8">
                <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-3">ì§€ì—­ ê²€ìƒ‰</label>
                <div class="relative group">
                    <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-400 group-focus-within:text-indigo-500 transition-colors">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                    </span>
                    <input 
                        type="text" 
                        id="regionSearch" 
                        placeholder="ì§€ì—­ ê²€ìƒ‰..." 
                        class="w-full bg-white border border-gray-200 text-gray-700 py-3 pl-10 pr-4 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all shadow-sm"
                    />
                </div>
                <div id="searchResults" class="mt-2 max-h-80 overflow-y-auto hidden"></div>
            </div>

            <div class="mb-8">
                <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-3">ë˜ëŠ” ì„ íƒ</label>
                <div class="relative group">
                    <select id="regionSelect" class="w-full bg-white border border-gray-200 text-gray-700 py-3 px-4 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all shadow-sm appearance-none cursor-pointer hover:border-indigo-300">
                        <option value="all">ì „ì²´ ë³´ê¸°</option>
                    </select>
                </div>
            </div>

            <div class="mb-6">
                <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-3">Menu</label>
                <nav class="space-y-1">
                    <a href="#dashboard" onclick="scrollToSection('dashboard')" class="menu-link flex items-center gap-3 px-4 py-3 bg-indigo-50 text-indigo-700 rounded-xl font-medium transition-colors">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path></svg>
                        ëŒ€ì‹œë³´ë“œ
                    </a>
                    <a href="#clusters" onclick="scrollToSection('clusters')" class="menu-link flex items-center gap-3 px-4 py-3 text-gray-600 hover:bg-gray-100 hover:text-gray-900 rounded-xl font-medium transition-colors">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"></path></svg>
                        êµ°ì§‘ ë¶„ì„
                    </a>
                    <a href="#ranking" onclick="scrollToSection('ranking')" class="menu-link flex items-center gap-3 px-4 py-3 text-gray-600 hover:bg-gray-100 hover:text-gray-900 rounded-xl font-medium transition-colors">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg>
                        ìˆœìœ„ ë¶„ì„
                    </a>
                </nav>
            </div>
            
            <div class="mt-auto pt-6 border-t border-gray-100">
                <div class="flex items-center gap-3 p-3 bg-white border border-gray-100 rounded-xl shadow-sm">
                    <div class="w-10 h-10 rounded-full bg-indigo-100 flex items-center justify-center text-sm font-bold text-indigo-600">
                        ğŸ‘¤
                    </div>
                    <div>
                        <p class="text-sm font-semibold text-gray-900">ì—°êµ¬ì</p>
                        <p class="text-xs text-gray-500">í¬í•­ì—¬ê³  êµ´ë¦¬íŠ¸íŒ€</p>
                    </div>
                </div>
            </div>
        </div>
    </aside>

    <!-- ë©”ì¸ ì»¨í…ì¸  -->
    <main class="flex-1 flex flex-col h-full overflow-hidden relative">
        <!-- í—¤ë” -->
        <header class="h-20 glass-header border-b border-gray-200 flex items-center justify-between px-8 z-10 sticky top-0">
            <h2 class="text-2xl font-bold text-gray-800">ì–´ë¦°ì´ êµí†µì‚¬ê³  ì•ˆì „ë„ ë¶„ì„</h2>
            <div class="flex items-center gap-4">
                <button class="p-2 text-gray-400 hover:text-gray-600 transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path></svg>
                </button>
                <div class="h-8 w-px bg-gray-200"></div>
                <span class="text-sm text-gray-500 font-medium">2024 ë°ì´í„° ê¸°ì¤€</span>
            </div>
        </header>

        <!-- ìŠ¤í¬ë¡¤ ì˜ì—­ -->
        <div class="flex-1 overflow-y-auto p-8 scroll-smooth">
            <div class="max-w-7xl mx-auto space-y-8">
                
                <!-- 1. KPI ì¹´ë“œ ì„¹ì…˜ -->
                <div id="dashboard">
                    <div class="flex items-center justify-between mb-5">
                        <h3 class="text-lg font-bold text-gray-800 flex items-center gap-2">
                            <span class="w-1 h-6 bg-indigo-600 rounded-full"></span>
                            ì „êµ­ ì•ˆì „ë„ ê°œìš”
                        </h3>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <!-- KPI ì¹´ë“œë“¤ -->
                        <div class="bg-white p-6 rounded-2xl card-shadow border border-white hover:border-indigo-100 transition-all group">
                            <div class="flex justify-between items-start mb-4">
                                <div>
                                    <p class="text-sm font-medium text-gray-500 mb-1">ì „ì²´ ë¶„ì„ ì§€ì—­</p>
                                    <h4 class="text-3xl font-extrabold text-gray-900 group-hover:text-indigo-600 transition-colors">
                                        <span id="totalRegions">225</span><span class="text-lg font-medium text-gray-400 ml-1">ê°œ</span>
                                    </h4>
                                </div>
                                <div class="p-3 bg-gray-50 rounded-xl text-gray-400 group-hover:bg-indigo-50 group-hover:text-indigo-600 transition-colors">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                </div>
                            </div>
                            <div class="w-full bg-gray-100 rounded-full h-1.5">
                                <div class="bg-indigo-500 h-1.5 rounded-full" style="width: 100%"></div>
                            </div>
                        </div>

                        <div class="bg-white p-6 rounded-2xl card-shadow border border-white hover:border-emerald-100 transition-all group">
                            <div class="flex justify-between items-start mb-4">
                                <div>
                                    <p class="text-sm font-medium text-gray-500 mb-1">ì•ˆì „ ì§€ì—­ (êµ°ì§‘ 0)</p>
                                    <h4 class="text-3xl font-extrabold text-emerald-600">
                                        <span id="safeRegions">0</span><span class="text-lg font-medium text-gray-400 ml-1">ê°œ</span>
                                    </h4>
                                </div>
                                <div class="p-3 bg-emerald-50 rounded-xl text-emerald-600">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                </div>
                            </div>
                            <div class="flex items-center gap-2 text-sm text-emerald-700 font-medium bg-emerald-50 px-3 py-1 rounded-lg w-fit">
                                <span class="w-2 h-2 rounded-full bg-emerald-500"></span>
                                <span id="safePercent">0</span>% ë¹„ì¤‘
                            </div>
                        </div>

                        <div class="bg-white p-6 rounded-2xl card-shadow border border-white hover:border-amber-100 transition-all group">
                            <div class="flex justify-between items-start mb-4">
                                <div>
                                    <p class="text-sm font-medium text-gray-500 mb-1">ì£¼ì˜ ì§€ì—­ (êµ°ì§‘ 1)</p>
                                    <h4 class="text-3xl font-extrabold text-amber-500">
                                        <span id="cautionRegions">0</span><span class="text-lg font-medium text-gray-400 ml-1">ê°œ</span>
                                    </h4>
                                </div>
                                <div class="p-3 bg-amber-50 rounded-xl text-amber-500">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>
                                </div>
                            </div>
                            <div class="flex items-center gap-2 text-sm text-amber-700 font-medium bg-amber-50 px-3 py-1 rounded-lg w-fit">
                                <span class="w-2 h-2 rounded-full bg-amber-500"></span>
                                <span id="cautionPercent">0</span>% ë¹„ì¤‘
                            </div>
                        </div>

                        <div class="bg-white p-6 rounded-2xl card-shadow border border-white hover:border-rose-100 transition-all group">
                            <div class="flex justify-between items-start mb-4">
                                <div>
                                    <p class="text-sm font-medium text-gray-500 mb-1">ìœ„í—˜ ì§€ì—­ (êµ°ì§‘ 2)</p>
                                    <h4 class="text-3xl font-extrabold text-rose-600">
                                        <span id="dangerRegions">0</span><span class="text-lg font-medium text-gray-400 ml-1">ê°œ</span>
                                    </h4>
                                </div>
                                <div class="p-3 bg-rose-50 rounded-xl text-rose-600 animate-pulse">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                </div>
                            </div>
                            <div class="flex items-center gap-2 text-sm text-rose-700 font-medium bg-rose-50 px-3 py-1 rounded-lg w-fit">
                                <span class="w-2 h-2 rounded-full bg-rose-500"></span>
                                ì¦‰ì‹œ ì¡°ì¹˜ í•„ìš”
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ì§€ì—­ ìƒì„¸ë³´ê¸° ì„¹ì…˜ (ìˆ¨ê¹€ ìƒíƒœ) -->
                <div id="regionDetail" style="display: none;">
                    <div class="mb-6">
                        <button onclick="document.getElementById('regionSelect').value='all'; showAllRegions();" class="text-indigo-600 hover:text-indigo-700 flex items-center gap-2 mb-4">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
                            ì „ì²´ ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°
                        </button>
                        <h2 class="text-3xl font-bold text-gray-900 flex items-center gap-3">
                            ğŸ” <span id="detailRegionName"></span>
                        </h2>
                    </div>

                    <!-- ì§€ì—­ ìƒì„¸ KPI -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <div class="bg-white p-6 rounded-2xl card-shadow border border-white">
                            <p class="text-sm font-medium text-gray-500 mb-2">í´ëŸ¬ìŠ¤í„° ë¶„ë¥˜</p>
                            <h4 class="text-2xl font-extrabold text-gray-900 flex items-center gap-2">
                                <span id="detailClusterIcon"></span>
                                <span id="detailCluster"></span>
                            </h4>
                        </div>

                        <div class="bg-white p-6 rounded-2xl card-shadow border border-white">
                            <p class="text-sm font-medium text-gray-500 mb-2">1000ëª…ë‹¹ ë¶€ìƒììˆ˜</p>
                            <h4 class="text-2xl font-extrabold text-indigo-600">
                                <span id="detailInjuries"></span><span class="text-lg text-gray-400">ëª…</span>
                            </h4>
                        </div>

                        <div class="bg-white p-6 rounded-2xl card-shadow border border-white">
                            <p class="text-sm font-medium text-gray-500 mb-2">1000ëª…ë‹¹ ì‚¬ê³ ê±´ìˆ˜</p>
                            <h4 class="text-2xl font-extrabold text-rose-600">
                                <span id="detailAccidents"></span><span class="text-lg text-gray-400">ê±´</span>
                            </h4>
                        </div>

                        <div class="bg-white p-6 rounded-2xl card-shadow border border-white">
                            <p class="text-sm font-medium text-gray-500 mb-2">ì „êµ­ í‰ê·  ëŒ€ë¹„</p>
                            <h4 class="text-2xl font-extrabold text-amber-600">
                                <span id="detailDiff"></span><span class="text-lg text-gray-400">ëª…</span>
                            </h4>
                            <p class="text-xs text-gray-500 mt-1">(<span id="detailDiffPercent"></span>)</p>
                        </div>
                    </div>

                    <!-- í†µê³„ ë¹„êµ -->
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                        <div class="bg-white p-6 rounded-2xl card-shadow border border-white">
                            <h4 class="font-bold text-gray-800 mb-4">ì „êµ­ í‰ê· </h4>
                            <div class="space-y-2">
                                <p class="text-sm text-gray-600">ë¶€ìƒììˆ˜: <span class="font-semibold" id="avgInjuries"></span>ëª…</p>
                                <p class="text-sm text-gray-600">ì‚¬ê³ ê±´ìˆ˜: <span class="font-semibold" id="avgAccidents"></span>ê±´</p>
                            </div>
                        </div>

                        <div class="bg-white p-6 rounded-2xl card-shadow border border-white">
                            <h4 class="font-bold text-gray-800 mb-4">í´ëŸ¬ìŠ¤í„° í‰ê· </h4>
                            <div class="space-y-2">
                                <p class="text-sm text-gray-600">ë¶€ìƒììˆ˜: <span class="font-semibold" id="clusterAvgInj"></span>ëª…</p>
                                <p class="text-sm text-gray-600">ì‚¬ê³ ê±´ìˆ˜: <span class="font-semibold" id="clusterAvgAcc"></span>ê±´</p>
                            </div>
                        </div>

                        <div class="bg-white p-6 rounded-2xl card-shadow border border-white">
                            <h4 class="font-bold text-gray-800 mb-4">ìˆœìœ„</h4>
                            <div class="space-y-2">
                                <p class="text-sm text-gray-600">ë¶€ìƒììˆ˜: <span class="font-semibold" id="detailInjuryRank"></span></p>
                                <p class="text-sm text-gray-600">ì‚¬ê³ ê±´ìˆ˜: <span class="font-semibold" id="detailAccidentRank"></span></p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 2. ì°¨íŠ¸ ì„¹ì…˜ -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="bg-white p-6 rounded-2xl card-shadow border border-white flex flex-col" style="height: 480px;">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-lg font-bold text-gray-800">ì „êµ­ í´ëŸ¬ìŠ¤í„° ë¶„í¬</h3>
                            <div class="flex gap-3 text-xs">
                                <span class="flex items-center gap-1"><span class="w-3 h-3 rounded-full bg-orange-500"></span>ì•ˆì „</span>
                                <span class="flex items-center gap-1"><span class="w-3 h-3 rounded-full bg-blue-500"></span>ì£¼ì˜</span>
                                <span class="flex items-center gap-1"><span class="w-3 h-3 rounded-full bg-green-500"></span>ìœ„í—˜</span>
                            </div>
                        </div>
                        <div class="flex-1 relative w-full h-full">
                            <canvas id="scatterChart"></canvas>
                        </div>
                    </div>

                    <div class="bg-white p-6 rounded-2xl card-shadow border border-white flex flex-col" style="height: 480px;">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-lg font-bold text-gray-800">í´ëŸ¬ìŠ¤í„°ë³„ í‰ê·  ì‚¬ê³ ìœ¨</h3>
                        </div>
                        <div class="flex-1 relative w-full h-full">
                            <canvas id="barChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- êµ°ì§‘ ë¶„ì„ ì„¹ì…˜ -->
                <div id="clusters" class="pt-4">
                    <div class="flex items-center justify-between mb-5">
                        <h3 class="text-lg font-bold text-gray-800 flex items-center gap-2">
                            <span class="w-1 h-6 bg-purple-500 rounded-full"></span>
                            ğŸ·ï¸êµ°ì§‘ë³„ ì§€ì—­ ë¶„ì„
                        </h3>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                        <!-- êµ°ì§‘ 0: ì•ˆì „ -->
                        <div class="bg-white rounded-2xl card-shadow border border-white overflow-hidden">
                            <div class="p-6 border-b border-gray-50 bg-gradient-to-r from-emerald-50 to-white">
                                <div class="flex items-center gap-3 mb-2">
                                    <div class="p-2 bg-emerald-100 rounded-lg text-emerald-600">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                    </div>
                                    <div>
                                        <h4 class="font-bold text-gray-800">êµ°ì§‘ 0 - ì•ˆì „</h4>
                                        <p class="text-xs text-gray-500">ë‚®ì€ ì‚¬ê³ ìœ¨ ì§€ì—­</p>
                                    </div>
                                </div>
                                <div class="text-2xl font-bold text-emerald-600"><span id="cluster0Count">0</span>ê°œ ì§€ì—­</div>
                            </div>
                            <div class="p-4 max-h-96 overflow-y-auto">
                                <div id="cluster0List" class="space-y-1"></div>
                            </div>
                        </div>

                        <!-- êµ°ì§‘ 1: ì£¼ì˜ -->
                        <div class="bg-white rounded-2xl card-shadow border border-white overflow-hidden">
                            <div class="p-6 border-b border-gray-50 bg-gradient-to-r from-amber-50 to-white">
                                <div class="flex items-center gap-3 mb-2">
                                    <div class="p-2 bg-amber-100 rounded-lg text-amber-600">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>
                                    </div>
                                    <div>
                                        <h4 class="font-bold text-gray-800">êµ°ì§‘ 1 - ì£¼ì˜</h4>
                                        <p class="text-xs text-gray-500">ì¤‘ê°„ ì‚¬ê³ ìœ¨ ì§€ì—­</p>
                                    </div>
                                </div>
                                <div class="text-2xl font-bold text-amber-600"><span id="cluster1Count">0</span>ê°œ ì§€ì—­</div>
                            </div>
                            <div class="p-4 max-h-96 overflow-y-auto">
                                <div id="cluster1List" class="space-y-1"></div>
                            </div>
                        </div>

                        <!-- êµ°ì§‘ 2: ìœ„í—˜ -->
                        <div class="bg-white rounded-2xl card-shadow border border-white overflow-hidden">
                            <div class="p-6 border-b border-gray-50 bg-gradient-to-r from-rose-50 to-white">
                                <div class="flex items-center gap-3 mb-2">
                                    <div class="p-2 bg-rose-100 rounded-lg text-rose-600 animate-pulse">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                    </div>
                                    <div>
                                        <h4 class="font-bold text-gray-800">êµ°ì§‘ 2 - ìœ„í—˜</h4>
                                        <p class="text-xs text-gray-500">ë†’ì€ ì‚¬ê³ ìœ¨ ì§€ì—­</p>
                                    </div>
                                </div>
                                <div class="text-2xl font-bold text-rose-600"><span id="cluster2Count">0</span>ê°œ ì§€ì—­</div>
                            </div>
                            <div class="p-4 max-h-96 overflow-y-auto">
                                <div id="cluster2List" class="space-y-1"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 3. ìˆœìœ„ ë¶„ì„ ì„¹ì…˜ -->
                <div id="ranking" class="pt-4">
                    <div class="flex items-center justify-between mb-5">
                        <h3 class="text-lg font-bold text-gray-800 flex items-center gap-2">
                            <span class="w-1 h-6 bg-rose-500 rounded-full"></span>
                            ì§€ì—­ë³„ ì•ˆì „ë„ ìˆœìœ„ ë¶„ì„
                        </h3>
                    </div>

                    <!-- ë¶€ìƒììˆ˜ ìˆœìœ„ -->
                    <div class="mb-8">
                        <h4 class="text-md font-bold text-gray-700 mb-4">ğŸ“Š ë¶€ìƒììˆ˜ ê¸°ì¤€</h4>
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            <!-- ìƒìœ„ 10ê°œ (ìœ„í—˜) -->
                            <div class="bg-white rounded-2xl card-shadow border border-white overflow-hidden">
                                <div class="p-6 border-b border-gray-50 flex items-center gap-3">
                                    <div class="p-2 bg-rose-100 rounded-lg text-rose-600">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>
                                    </div>
                                    <h4 class="font-bold text-gray-800">ë¶€ìƒììˆ˜ ìƒìœ„ 10ê°œ ì§€ì—­ (ìœ„í—˜)</h4>
                                </div>
                                <div class="overflow-x-auto">
                                    <table class="w-full custom-table">
                                        <thead class="bg-gray-50">
                                            <tr>
                                                <th>ìˆœìœ„</th>
                                                <th>ì§€ì—­</th>
                                                <th class="text-right">ë¶€ìƒììˆ˜(1k)</th>
                                                <th class="text-right">ì‚¬ê³ ê±´ìˆ˜(1k)</th>
                                                <th>ë“±ê¸‰</th>
                                            </tr>
                                        </thead>
                                        <tbody id="topRegionsTable">
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <!-- í•˜ìœ„ 10ê°œ (ì•ˆì „) -->
                            <div class="bg-white rounded-2xl card-shadow border border-white overflow-hidden">
                                <div class="p-6 border-b border-gray-50 flex items-center gap-3">
                                    <div class="p-2 bg-emerald-100 rounded-lg text-emerald-600">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                    </div>
                                    <h4 class="font-bold text-gray-800">ë¶€ìƒììˆ˜ í•˜ìœ„ 10ê°œ ì§€ì—­ (ì•ˆì „)</h4>
                                </div>
                                <div class="overflow-x-auto">
                                    <table class="w-full custom-table">
                                        <thead class="bg-gray-50">
                                            <tr>
                                                <th>ìˆœìœ„</th>
                                                <th>ì§€ì—­</th>
                                                <th class="text-right">ë¶€ìƒììˆ˜(1k)</th>
                                                <th class="text-right">ì‚¬ê³ ê±´ìˆ˜(1k)</th>
                                                <th>ë“±ê¸‰</th>
                                            </tr>
                                        </thead>
                                        <tbody id="bottomRegionsTable">
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ì‚¬ê³ ê±´ìˆ˜ ìˆœìœ„ -->
                    <div class="mb-8">
                        <h4 class="text-md font-bold text-gray-700 mb-4">ğŸš— ì‚¬ê³ ê±´ìˆ˜ ê¸°ì¤€</h4>
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            <!-- ìƒìœ„ 10ê°œ (ìœ„í—˜) -->
                            <div class="bg-white rounded-2xl card-shadow border border-white overflow-hidden">
                                <div class="p-6 border-b border-gray-50 flex items-center gap-3">
                                    <div class="p-2 bg-rose-100 rounded-lg text-rose-600">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>
                                    </div>
                                    <h4 class="font-bold text-gray-800">ì‚¬ê³ ê±´ìˆ˜ ìƒìœ„ 10ê°œ ì§€ì—­ (ìœ„í—˜)</h4>
                                </div>
                                <div class="overflow-x-auto">
                                    <table class="w-full custom-table">
                                        <thead class="bg-gray-50">
                                            <tr>
                                                <th>ìˆœìœ„</th>
                                                <th>ì§€ì—­</th>
                                                <th class="text-right">ì‚¬ê³ ê±´ìˆ˜(1k)</th>
                                                <th class="text-right">ë¶€ìƒììˆ˜(1k)</th>
                                                <th>ë“±ê¸‰</th>
                                            </tr>
                                        </thead>
                                        <tbody id="topAccidentsTable">
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <!-- í•˜ìœ„ 10ê°œ (ì•ˆì „) -->
                            <div class="bg-white rounded-2xl card-shadow border border-white overflow-hidden">
                                <div class="p-6 border-b border-gray-50 flex items-center gap-3">
                                    <div class="p-2 bg-emerald-100 rounded-lg text-emerald-600">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                    </div>
                                    <h4 class="font-bold text-gray-800">ì‚¬ê³ ê±´ìˆ˜ í•˜ìœ„ 10ê°œ ì§€ì—­ (ì•ˆì „)</h4>
                                </div>
                                <div class="overflow-x-auto">
                                    <table class="w-full custom-table">
                                        <thead class="bg-gray-50">
                                            <tr>
                                                <th>ìˆœìœ„</th>
                                                <th>ì§€ì—­</th>
                                                <th class="text-right">ì‚¬ê³ ê±´ìˆ˜(1k)</th>
                                                <th class="text-right">ë¶€ìƒììˆ˜(1k)</th>
                                                <th>ë“±ê¸‰</th>
                                            </tr>
                                        </thead>
                                        <tbody id="bottomAccidentsTable">
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                </div>
                <!-- dashboard div ì¢…ë£Œ -->

                <!-- í‘¸í„° -->
                <div class="mt-8 p-6 bg-white rounded-2xl card-shadow border border-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-semibold text-gray-800 mb-1">ğŸ“Š ë¶„ì„ ì •ë³´</p>
                            <p class="text-xs text-gray-500">í´ëŸ¬ìŠ¤í„°ë§: K-Means (K=3) | ì‹¤ë£¨ì—£ ìŠ¤ì½”ì–´: <span id="silhouetteScore">0.000</span></p>
                        </div>
                        <div class="text-right">
                            <p class="text-sm font-semibold text-gray-800 mb-1">ğŸ« í¬í•­ì—¬ìê³ ë“±í•™êµ</p>
                            <p class="text-xs text-gray-500">ì œ5íšŒ í•™ìƒ SW-AI ì¸ì¬ ì–‘ì„± í”„ë¡œì íŠ¸</p>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </main>

    <script>
        // ì‹¤ì œ ë°ì´í„°
        const rawData = `Location,Injuries_1000,Accidents_1000
ì¶©ë¶ì¶©ì£¼ì‹œ,4.38,3.41
ì¶©ë¶ì²­ì£¼ì‹œ,3.50,2.69
ì¶©ë¶ì§„ì²œêµ°,3.79,3.35
ì¶©ë¶ì¦í‰êµ°,3.42,2.85
ì¶©ë¶ì œì²œì‹œ,6.44,4.43
ì¶©ë¶ìŒì„±êµ°,4.70,3.40
ì¶©ë¶ì˜¥ì²œêµ°,2.98,2.24
ì¶©ë¶ì˜ë™êµ°,1.83,1.83
ì¶©ë¶ë³´ì€êµ°,4.64,3.97
ì¶©ë¶ë‹¨ì–‘êµ°,6.22,4.67
ì¶©ë¶ê´´ì‚°êµ°,5.85,3.90
ì¶©ë‚¨í™ì„±êµ°,2.26,2.03
ì¶©ë‚¨íƒœì•ˆêµ°,4.68,3.43
ì¶©ë‚¨ì²­ì–‘êµ°,2.99,1.49
ì¶©ë‚¨ì²œì•ˆì‹œ,2.34,2.00
ì¶©ë‚¨ì˜ˆì‚°êµ°,5.13,3.90
ì¶©ë‚¨ì•„ì‚°ì‹œ,2.21,1.74
ì¶©ë‚¨ì„œì²œêµ°,5.03,3.36
ì¶©ë‚¨ì„œì‚°ì‹œ,2.81,2.33
ì¶©ë‚¨ë¶€ì—¬êµ°,2.02,1.35
ì¶©ë‚¨ë³´ë ¹ì‹œ,2.35,2.19
ì¶©ë‚¨ë‹¹ì§„ì‹œ,2.72,1.93
ì¶©ë‚¨ë…¼ì‚°ì‹œ,6.10,2.79
ì¶©ë‚¨ê¸ˆì‚°êµ°,1.88,1.13
ì¶©ë‚¨ê³µì£¼ì‹œ,5.24,3.60
ì¶©ë‚¨ê³„ë£¡ì‹œ,2.30,1.53
ì œì£¼ì œì£¼ì‹œ,3.95,3.09
ì œì£¼ì„œê·€í¬ì‹œ,5.99,4.67
ì „ë¶ì§„ì•ˆêµ°,1.67,1.67
ì „ë¶ì •ìì‹œ,2.19,2.19
ì „ë¶ì „ì£¼ì‹œ,2.22,1.72
ì „ë¶ì¥ìˆ˜êµ°,1.75,1.75
ì „ë¶ì„ì‹¤êµ°,1.41,1.41
ì „ë¶ìµì‚°ì‹œ,1.99,1.75
ì „ë¶ì™„ì£¼êµ°,2.52,1.95
ì „ë¶ìˆœì°½êµ°,4.48,2.56
ì „ë¶ë¶€ì•ˆêµ°,3.36,2.61
ì „ë¶ë¬´ì£¼êµ°,6.63,5.80
ì „ë¶ë‚¨ì›ì‹œ,1.16,0.77
ì „ë¶ê¹€ì œì‹œ,3.22,3.01
ì „ë¶êµ°ì‚°ì‹œ,3.16,2.37
ì „ë¶ê³ ì°½êµ°,2.78,1.74
ì „ë‚¨í™”ìˆœêµ°,2.61,1.83
ì „ë‚¨í•´ë‚¨êµ°,5.66,4.37
ì „ë‚¨í•¨í‰êµ°,5.75,2.88
ì „ë‚¨ì§„ë„êµ°,2.29,2.29
ì „ë‚¨ì¥í¥êµ°,4.83,3.38
ì „ë‚¨ì¥ì„±êµ°,6.35,4.48
ì „ë‚¨ì™„ë„êµ°,2.52,2.20
ì „ë‚¨ì˜ì•”êµ°,3.18,2.89
ì „ë‚¨ì˜ê´‘êµ°,2.99,1.84
ì „ë‚¨ì—¬ìˆ˜ì‹œ,3.98,3.33
ì „ë‚¨ì‹ ì•ˆêµ°,2.22,2.22
ì „ë‚¨ìˆœì²œì‹œ,2.15,1.68
ì „ë‚¨ë³´ì„±êµ°,3.41,3.41
ì „ë‚¨ë¬´ì•ˆêµ°,2.66,2.09
ì „ë‚¨ëª©í¬ì‹œ,4.31,3.29
ì „ë‚¨ë‹´ì–‘êµ°,8.91,6.20
ì „ë‚¨ë‚˜ì£¼ì‹œ,3.65,2.49
ì „ë‚¨ê´‘ì–‘ì‹œ,2.96,2.45
ì „ë‚¨ê³¡ì„±êµ°,3.50,2.62
ì „ë‚¨ê³ í¥êµ°,1.08,1.08
ì „ë‚¨ê°•ì§„êµ°,3.62,3.62
ì¸ì²œì¤‘êµ¬,1.80,1.63
ì¸ì²œì˜¹ì§„êµ°,2.39,2.39
ì¸ì²œì—°ìˆ˜êµ¬,0.86,0.80
ì¸ì²œì„œêµ¬,1.49,1.21
ì¸ì²œë¶€í‰êµ¬,1.12,0.99
ì¸ì²œë¯¸ì¶”í™€êµ¬,1.83,1.65
ì¸ì²œë™êµ¬,2.66,2.66
ì¸ì²œë‚¨ë™êµ¬,2.26,2.06
ì¸ì²œê³„ì–‘êµ¬,1.32,1.17
ì¸ì²œê°•í™”êµ°,4.43,3.91
ìš¸ì‚°ì¤‘êµ¬,1.20,1.03
ìš¸ì‚°ìš¸ì£¼êµ°,2.35,1.71
ìš¸ì‚°ë¶êµ¬,1.88,1.58
ìš¸ì‚°ë™êµ¬,1.62,1.49
ìš¸ì‚°ë‚¨êµ¬,2.00,1.70
ì„¸ì¢…ì„¸ì¢…ì‹œ,2.08,1.78
ì„œìš¸ì¤‘ë‘êµ¬,2.41,1.88
ì„œìš¸ì¤‘êµ¬,3.70,3.13
ì„œìš¸ì¢…ë¡œêµ¬,2.48,2.35
ì„œìš¸ì€í‰êµ¬,1.97,1.71
ì„œìš¸ìš©ì‚°êµ¬,1.58,1.29
ì„œìš¸ì˜ë“±í¬êµ¬,2.68,2.18
ì„œìš¸ì–‘ì²œêµ¬,1.90,1.76
ì„œìš¸ì†¡íŒŒêµ¬,2.19,1.80
ì„œìš¸ì„±ë¶êµ¬,1.16,1.03
ì„œìš¸ì„±ë™êµ¬,1.38,1.19
ì„œìš¸ì„œì´ˆêµ¬,2.32,1.82
ì„œìš¸ì„œëŒ€ë¬¸êµ¬,1.75,1.45
ì„œìš¸ë§ˆí¬êµ¬,1.56,1.30
ì„œìš¸ë™ì‘êµ¬,1.63,1.39
ì„œìš¸ë™ëŒ€ë¬¸êµ¬,2.20,1.86
ì„œìš¸ë„ë´‰êµ¬,1.22,1.11
ì„œìš¸ë…¸ì›êµ¬,2.03,1.76
ì„œìš¸ê¸ˆì²œêµ¬,3.21,2.57
ì„œìš¸êµ¬ë¡œêµ¬,1.44,1.24
ì„œìš¸ê´‘ì§„êµ¬,1.37,1.12
ì„œìš¸ê´€ì•…êµ¬,2.02,1.36
ì„œìš¸ê°•ì„œêµ¬,1.37,1.20
ì„œìš¸ê°•ë¶êµ¬,2.25,1.87
ì„œìš¸ê°•ë™êµ¬,2.08,1.69
ì„œìš¸ê°•ë‚¨êµ¬,2.10,1.79
ë¶€ì‚°í•´ìš´ëŒ€êµ¬,1.43,1.08
ë¶€ì‚°ì§„êµ¬,1.80,1.60
ë¶€ì‚°ì¤‘êµ¬,17.44,14.82
ë¶€ì‚°ì˜ë„êµ¬,2.44,2.27
ë¶€ì‚°ì—°ì œêµ¬,1.54,1.32
ë¶€ì‚°ìˆ˜ì˜êµ¬,3.77,3.00
ë¶€ì‚°ì„œêµ¬,3.23,2.92
ë¶€ì‚°ì‚¬í•˜êµ¬,2.49,1.87
ë¶€ì‚°ì‚¬ìƒêµ¬,2.17,1.85
ë¶€ì‚°ë¶êµ¬,1.69,1.45
ë¶€ì‚°ë™ë˜êµ¬,2.15,1.70
ë¶€ì‚°ë™êµ¬,3.99,2.99
ë¶€ì‚°ë‚¨êµ¬,2.27,1.96
ë¶€ì‚°ê¸°ì¥êµ°,2.83,2.24
ë¶€ì‚°ê¸ˆì •êµ¬,2.51,2.28
ë¶€ì‚°ê°•ì„œêµ¬,2.46,1.88
ëŒ€ì „ì¤‘êµ¬,3.49,2.97
ëŒ€ì „ìœ ì„±êµ¬,2.79,2.28
ëŒ€ì „ì„œêµ¬,3.53,2.82
ëŒ€ì „ë™êµ¬,3.16,2.63
ëŒ€ì „ëŒ€ë•êµ¬,4.50,3.50
ëŒ€êµ¬ì¤‘êµ¬,4.22,3.24
ëŒ€êµ¬ìˆ˜ì„±êµ¬,3.03,2.70
ëŒ€êµ¬ì„œêµ¬,3.95,3.64
ëŒ€êµ¬ë¶êµ¬,2.60,2.28
ëŒ€êµ¬ë™êµ¬,2.80,2.17
ëŒ€êµ¬ë‹¬ì„±êµ°,2.05,1.77
ëŒ€êµ¬ë‹¬ì„œêµ¬,3.59,3.13
ëŒ€êµ¬ë‚¨êµ¬,2.41,2.01
ëŒ€êµ¬êµ°ìœ„êµ°,7.12,7.12
ê´‘ì£¼ì„œêµ¬,3.76,2.91
ê´‘ì£¼ë¶êµ¬,3.03,2.65
ê´‘ì£¼ë™êµ¬,1.71,1.28
ê´‘ì£¼ë‚¨êµ¬,2.38,1.95
ê´‘ì£¼ê´‘ì‚°êµ¬,3.41,2.87
ê²½ë¶í¬í•­ì‹œ,3.57,2.99
ê²½ë¶ì¹ ê³¡êµ°,2.54,1.99
ê²½ë¶ì²­ì†¡êµ°,5.55,3.70
ê²½ë¶ì²­ë„êµ°,4.88,4.27
ê²½ë¶ì˜ì„±êµ°,3.06,2.55
ê²½ë¶ìš¸ì§„êµ°,4.18,2.90
ê²½ë¶ì˜ˆì²œêµ°,1.31,1.31
ê²½ë¶ì˜ì²œì‹œ,4.15,3.51
ê²½ë¶ì˜ì£¼ì‹œ,0.74,0.44
ê²½ë¶ì˜ì–‘êµ°,4.34,2.89
ê²½ë¶ì˜ë•êµ°,6.29,5.03
ê²½ë¶ì•ˆë™ì‹œ,4.70,3.57
ê²½ë¶ì„±ì£¼êµ°,1.54,1.54
ê²½ë¶ìƒì£¼ì‹œ,5.10,3.87
ê²½ë¶ë¬¸ê²½ì‹œ,2.34,2.11
ê²½ë¶ê¹€ì²œì‹œ,0.80,0.71
ê²½ë¶êµ¬ë¯¸ì‹œ,1.80,1.57
ê²½ë¶ê³ ë ¹êµ°,1.40,1.40
ê²½ë¶ê²½ì£¼ì‹œ,5.20,3.02
ê²½ë¶ê²½ì‚°ì‹œ,2.54,2.18
ê²½ë‚¨í•©ì²œêµ°,3.76,2.51
ê²½ë‚¨í•¨ì–‘êµ°,1.04,1.04
ê²½ë‚¨í•¨ì•ˆêµ°,2.30,1.79
ê²½ë‚¨í•˜ë™êµ°,3.36,2.80
ê²½ë‚¨í†µì˜ì‹œ,5.52,3.68
ê²½ë‚¨ì°½ì›ì‹œ,1.50,1.23
ê²½ë‚¨ì°½ë…•êµ°,4.32,3.65
ê²½ë‚¨ì§„ì£¼ì‹œ,1.04,0.85
ê²½ë‚¨ì–‘ì‚°ì‹œ,1.97,1.63
ê²½ë‚¨ì‚°ì²­êµ°,5.29,4.54
ê²½ë‚¨ì‚¬ì²œì‹œ,2.84,2.39
ê²½ë‚¨ë°€ì–‘ì‹œ,2.83,2.16
ê²½ë‚¨ë‚¨í•´êµ°,3.80,2.72
ê²½ë‚¨ê¹€í•´ì‹œ,1.93,1.55
ê²½ë‚¨ê³ ì„±êµ°,2.42,2.01
ê²½ë‚¨ê±°ì°½êµ°,0.71,0.47
ê²½ë‚¨ê±°ì œì‹œ,1.82,1.74
ê²½ê¸°í™”ì„±ì‹œ,2.43,1.91
ê²½ê¸°í•˜ë‚¨ì‹œ,2.01,1.51
ê²½ê¸°í¬ì²œì‹œ,3.76,2.97
ê²½ê¸°í‰íƒì‹œ,2.81,2.22
ê²½ê¸°íŒŒì£¼ì‹œ,1.66,1.39
ê²½ê¸°ì´ì²œì‹œ,3.75,2.74
ê²½ê¸°ì˜ì •ë¶€ì‹œ,2.69,2.27
ê²½ê¸°ì˜ì™•ì‹œ,2.31,1.70
ê²½ê¸°ìš©ì¸ì‹œ,2.33,1.81
ê²½ê¸°ì˜¤ì‚°ì‹œ,2.52,2.18
ê²½ê¸°ì—°ì²œêµ°,6.34,4.85
ê²½ê¸°ì—¬ì£¼ì‹œ,4.77,2.98
ê²½ê¸°ì–‘í‰êµ°,7.60,4.69
ê²½ê¸°ì–‘ì£¼ì‹œ,2.51,2.10
ê²½ê¸°ì•ˆì–‘ì‹œ,1.64,1.38
ê²½ê¸°ì•ˆì„±ì‹œ,4.45,3.51
ê²½ê¸°ì•ˆì‚°ì‹œ,4.09,3.23
ê²½ê¸°ì‹œí¥ì‹œ,2.36,1.97
ê²½ê¸°ìˆ˜ì›ì‹œ,2.39,1.96
ê²½ê¸°ì„±ë‚¨ì‹œ,2.33,1.82
ê²½ê¸°ë¶€ì²œì‹œ,2.55,2.24
ê²½ê¸°ë™ë‘ì²œì‹œ,3.67,3.00
ê²½ê¸°ë‚¨ì–‘ì£¼ì‹œ,2.19,1.80
ê²½ê¸°ê¹€í¬ì‹œ,2.24,1.74
ê²½ê¸°êµ°í¬ì‹œ,1.45,1.25
ê²½ê¸°êµ¬ë¦¬ì‹œ,3.16,2.65
ê²½ê¸°ê´‘ì£¼ì‹œ,4.05,3.23
ê²½ê¸°ê´‘ëª…ì‹œ,2.59,2.19
ê²½ê¸°ê³¼ì²œì‹œ,0.77,0.52
ê²½ê¸°ê³ ì–‘ì‹œ,1.68,1.48
ê²½ê¸°ê°€í‰êµ°,3.69,3.17
ê°•ì›íš¡ì„±êµ°,6.01,3.61
ê°•ì›í™”ì²œêµ°,6.44,4.29
ê°•ì›í™ì²œêµ°,1.18,1.18
ê°•ì›í‰ì°½êµ°,8.96,7.47
ê°•ì›íƒœë°±ì‹œ,5.92,4.74
ê°•ì›ì¶˜ì²œì‹œ,3.58,3.03
ê°•ì›ì² ì›êµ°,1.22,1.22
ê°•ì›ì •ì„ êµ°,7.94,3.97
ê°•ì›ì¸ì œêµ°,2.81,1.76
ê°•ì›ì›ì£¼ì‹œ,2.80,2.05
ê°•ì›ì˜ì›”êµ°,4.67,3.63
ê°•ì›ì–‘ì–‘êµ°,10.31,7.09
ê°•ì›ì–‘êµ¬êµ°,8.83,2.21
ê°•ì›ì†ì´ˆì‹œ,5.37,4.18
ê°•ì›ì‚¼ì²™ì‹œ,1.92,1.68
ê°•ì›ë™í•´ì‹œ,2.16,1.48
ê°•ì›ê³ ì„±êµ°,8.40,5.40
ê°•ì›ê°•ë¦‰ì‹œ,2.19,1.80`;

        // CSV íŒŒì‹±
        function parseCSV(csv) {
            const lines = csv.trim().split('\n');
            const headers = lines[0].split(',');
            return lines.slice(1).map(line => {
                const values = line.split(',');
                return {
                    Location: values[0],
                    Injuries_1000: parseFloat(values[1]),
                    Accidents_1000: parseFloat(values[2])
                };
            });
        }

        // Seeded Random Number Generator (ì¬í˜„ ê°€ëŠ¥í•œ ëœë¤)
        function seededRandom(seed) {
            let value = seed;
            return function() {
                value = (value * 9301 + 49297) % 233280;
                return value / 233280;
            };
        }

        // K-means í´ëŸ¬ìŠ¤í„°ë§ (ê²°ì •ë¡ ì  ë²„ì „)
        function performKMeans(data, k = 3, maxIterations = 100, runs = 10) {
            let bestResult = null;
            let bestInertia = Infinity;

            // ì—¬ëŸ¬ ë²ˆ ì‹¤í–‰í•´ì„œ ê°€ì¥ ì¢‹ì€ ê²°ê³¼ ì„ íƒ
            for (let run = 0; run < runs; run++) {
                const result = performSingleKMeans(data, k, maxIterations, run);
                if (result.inertia < bestInertia) {
                    bestInertia = result.inertia;
                    bestResult = result;
                }
            }

            return bestResult;
        }

        function performSingleKMeans(data, k, maxIterations, seed) {
            const random = seededRandom(seed * 12345);

            // 1. ë°ì´í„° í‘œì¤€í™”
            const injuries = data.map(d => d.Injuries_1000);
            const accidents = data.map(d => d.Accidents_1000);
            
            const meanInj = injuries.reduce((a, b) => a + b) / injuries.length;
            const meanAcc = accidents.reduce((a, b) => a + b) / accidents.length;
            const stdInj = Math.sqrt(injuries.reduce((sum, val) => sum + Math.pow(val - meanInj, 2), 0) / injuries.length);
            const stdAcc = Math.sqrt(accidents.reduce((sum, val) => sum + Math.pow(val - meanAcc, 2), 0) / accidents.length);
            
            const normalized = data.map(d => ({
                ...d,
                normInj: (d.Injuries_1000 - meanInj) / stdInj,
                normAcc: (d.Accidents_1000 - meanAcc) / stdAcc
            }));

            // 2. ì´ˆê¸° ì¤‘ì‹¬ì  ì„ íƒ (K-means++)
            const centroids = [];
            // ì²« ë²ˆì§¸ ì¤‘ì‹¬ì : seeded random
            centroids.push(normalized[Math.floor(random() * normalized.length)]);
            
            // ë‚˜ë¨¸ì§€ ì¤‘ì‹¬ì : ê±°ë¦¬ ê¸°ë°˜ í™•ë¥ ì  ì„ íƒ
            for (let i = 1; i < k; i++) {
                const distances = normalized.map(point => {
                    const minDist = Math.min(...centroids.map(c => 
                        Math.pow(point.normInj - c.normInj, 2) + Math.pow(point.normAcc - c.normAcc, 2)
                    ));
                    return minDist;
                });
                
                const totalDist = distances.reduce((a, b) => a + b);
                const probabilities = distances.map(d => d / totalDist);
                
                let rand = random();
                let cumsum = 0;
                for (let j = 0; j < probabilities.length; j++) {
                    cumsum += probabilities[j];
                    if (rand <= cumsum) {
                        centroids.push(normalized[j]);
                        break;
                    }
                }
            }

            // 3. K-means ë°˜ë³µ
            let assignments = new Array(normalized.length).fill(0);
            let converged = false;
            let iteration = 0;

            while (!converged && iteration < maxIterations) {
                // ê° ì ì„ ê°€ì¥ ê°€ê¹Œìš´ ì¤‘ì‹¬ì ì— í• ë‹¹
                const newAssignments = normalized.map(point => {
                    const distances = centroids.map(c => 
                        Math.pow(point.normInj - c.normInj, 2) + Math.pow(point.normAcc - c.normAcc, 2)
                    );
                    return distances.indexOf(Math.min(...distances));
                });

                // ìˆ˜ë ´ í™•ì¸
                converged = newAssignments.every((val, idx) => val === assignments[idx]);
                assignments = newAssignments;

                // ì¤‘ì‹¬ì  ì—…ë°ì´íŠ¸
                if (!converged) {
                    for (let i = 0; i < k; i++) {
                        const clusterPoints = normalized.filter((_, idx) => assignments[idx] === i);
                        if (clusterPoints.length > 0) {
                            centroids[i] = {
                                normInj: clusterPoints.reduce((sum, p) => sum + p.normInj, 0) / clusterPoints.length,
                                normAcc: clusterPoints.reduce((sum, p) => sum + p.normAcc, 0) / clusterPoints.length
                            };
                        }
                    }
                }

                iteration++;
            }

            // 4. Inertia ê³„ì‚° (í´ëŸ¬ìŠ¤í„° ë‚´ ê±°ë¦¬ í•©)
            let inertia = 0;
            normalized.forEach((point, i) => {
                const centroid = centroids[assignments[i]];
                inertia += Math.pow(point.normInj - centroid.normInj, 2) + Math.pow(point.normAcc - centroid.normAcc, 2);
            });

            // 5. í´ëŸ¬ìŠ¤í„° ë ˆì´ë¸”ë§ (í‰ê· ê°’ ê¸°ì¤€ìœ¼ë¡œ 0=ì•ˆì „, 1=ì£¼ì˜, 2=ìœ„í—˜)
            const clusterMeans = [];
            for (let i = 0; i < k; i++) {
                const clusterPoints = normalized.filter((_, idx) => assignments[idx] === i);
                const meanScore = clusterPoints.reduce((sum, p) => sum + p.Injuries_1000, 0) / clusterPoints.length;
                clusterMeans.push({ cluster: i, mean: meanScore });
            }
            clusterMeans.sort((a, b) => a.mean - b.mean);
            
            const clusterMapping = {};
            clusterMeans.forEach((item, idx) => {
                clusterMapping[item.cluster] = idx;
            });

            // 6. ì‹¤ë£¨ì—£ ìŠ¤ì½”ì–´ ê³„ì‚°
            let silhouetteSum = 0;
            normalized.forEach((point, i) => {
                const ownCluster = assignments[i];
                const sameCluster = normalized.filter((_, idx) => assignments[idx] === ownCluster && idx !== i);
                
                if (sameCluster.length === 0) return;
                
                // a: ê°™ì€ í´ëŸ¬ìŠ¤í„° ë‚´ í‰ê·  ê±°ë¦¬
                const a = sameCluster.reduce((sum, p) => 
                    sum + Math.sqrt(Math.pow(point.normInj - p.normInj, 2) + Math.pow(point.normAcc - p.normAcc, 2))
                , 0) / sameCluster.length;
                
                // b: ê°€ì¥ ê°€ê¹Œìš´ ë‹¤ë¥¸ í´ëŸ¬ìŠ¤í„°ê¹Œì§€ì˜ í‰ê·  ê±°ë¦¬
                const otherClusters = [...Array(k).keys()].filter(c => c !== ownCluster);
                const b = Math.min(...otherClusters.map(c => {
                    const otherClusterPoints = normalized.filter((_, idx) => assignments[idx] === c);
                    if (otherClusterPoints.length === 0) return Infinity;
                    return otherClusterPoints.reduce((sum, p) => 
                        sum + Math.sqrt(Math.pow(point.normInj - p.normInj, 2) + Math.pow(point.normAcc - p.normAcc, 2))
                    , 0) / otherClusterPoints.length;
                }));
                
                silhouetteSum += (b - a) / Math.max(a, b);
            });
            
            const silhouetteScore = silhouetteSum / normalized.length;

            // 7. ì¤‘ì‹¬ì ì„ ì›ë˜ ìŠ¤ì¼€ì¼ë¡œ ë³µì›
            const originalCentroids = centroids.map(c => ({
                Injuries_1000: c.normInj * stdInj + meanInj,
                Accidents_1000: c.normAcc * stdAcc + meanAcc,
                cluster: clusterMapping[centroids.indexOf(c)]
            }));
            originalCentroids.sort((a, b) => a.cluster - b.cluster);

            return {
                data: normalized.map((d, i) => ({ ...d, cluster: clusterMapping[assignments[i]] })),
                centroids: originalCentroids,
                silhouetteScore: silhouetteScore,
                iterations: iteration,
                inertia: inertia
            };
        }

        // ë°ì´í„° ë¡œë“œ ë° ì²˜ë¦¬
        const data = parseCSV(rawData);
        const kmeansResult = performKMeans(data, 3);
        const clusteredData = kmeansResult.data;
        const centroids = kmeansResult.centroids;
        const silhouetteScore = kmeansResult.silhouetteScore;

        console.log('K-means ì™„ë£Œ (10ë²ˆ ì‹¤í–‰ ì¤‘ ìµœì  ì„ íƒ)');
        console.log('ë°˜ë³µ íšŸìˆ˜:', kmeansResult.iterations);
        console.log('Inertia:', kmeansResult.inertia.toFixed(3));
        console.log('ì‹¤ë£¨ì—£ ìŠ¤ì½”ì–´:', silhouetteScore.toFixed(3));
        console.log('ì¤‘ì‹¬ì :', centroids);
        console.log('í´ëŸ¬ìŠ¤í„°ë³„ ê°œìˆ˜:', {
            'ì•ˆì „(0)': clusteredData.filter(d => d.cluster === 0).length,
            'ì£¼ì˜(1)': clusteredData.filter(d => d.cluster === 1).length,
            'ìœ„í—˜(2)': clusteredData.filter(d => d.cluster === 2).length
        });

        // í†µê³„ ê³„ì‚°
        const totalRegions = clusteredData.length;
        const cluster0 = clusteredData.filter(d => d.cluster === 0).length;
        const cluster1 = clusteredData.filter(d => d.cluster === 1).length;
        const cluster2 = clusteredData.filter(d => d.cluster === 2).length;

        // KPI ì—…ë°ì´íŠ¸
        document.getElementById('totalRegions').textContent = totalRegions;
        document.getElementById('safeRegions').textContent = cluster0;
        document.getElementById('cautionRegions').textContent = cluster1;
        document.getElementById('dangerRegions').textContent = cluster2;
        document.getElementById('safePercent').textContent = ((cluster0/totalRegions)*100).toFixed(1);
        document.getElementById('cautionPercent').textContent = ((cluster1/totalRegions)*100).toFixed(1);
        document.getElementById('silhouetteScore').textContent = silhouetteScore.toFixed(3);

        // êµ°ì§‘ë³„ ì§€ì—­ ë¦¬ìŠ¤íŠ¸ ìƒì„±
        const clusterNames = { 0: 'ì•ˆì „', 1: 'ì£¼ì˜', 2: 'ìœ„í—˜' };
        const clusterColors = { 0: 'emerald', 1: 'amber', 2: 'rose' };

        document.getElementById('cluster0Count').textContent = cluster0;
        document.getElementById('cluster1Count').textContent = cluster1;
        document.getElementById('cluster2Count').textContent = cluster2;

        function populateClusterList(clusterId) {
            const regions = clusteredData.filter(d => d.cluster === clusterId)
                .sort((a, b) => a.Location.localeCompare(b.Location, 'ko'));
            
            const color = clusterColors[clusterId];
            const listElement = document.getElementById(`cluster${clusterId}List`);
            
            listElement.innerHTML = regions.map(r => `
                <div class="px-3 py-2 hover:bg-${color}-50 rounded-lg cursor-pointer transition-colors text-sm region-item" 
                     data-location="${r.Location}"
                     onclick="selectRegion('${r.Location}')">
                    <span class="font-medium text-gray-800">${r.Location}</span>
                    <span class="text-xs text-gray-500 ml-2">(${r.Injuries_1000.toFixed(2)}ëª…)</span>
                </div>
            `).join('');
        }

        populateClusterList(0);
        populateClusterList(1);
        populateClusterList(2);

        // ì§€ì—­ ì„ íƒ ë“œë¡­ë‹¤ìš´ ì±„ìš°ê¸°
        const regionSelect = document.getElementById('regionSelect');
        clusteredData.forEach(d => {
            const option = document.createElement('option');
            option.value = d.Location;
            option.textContent = d.Location;
            regionSelect.appendChild(option);
        });

        // ê²€ìƒ‰ ê¸°ëŠ¥
        const searchInput = document.getElementById('regionSearch');
        const searchResults = document.getElementById('searchResults');

        searchInput.addEventListener('input', function() {
            const query = this.value.toLowerCase().trim();
            
            if (query.length === 0) {
                searchResults.classList.add('hidden');
                return;
            }

            const matches = clusteredData.filter(d => 
                d.Location.toLowerCase().includes(query)
            ); // ì œí•œ ì—†ì´ ëª¨ë“  ê²°ê³¼ í‘œì‹œ

            if (matches.length > 0) {
                const countHeader = `<div class="px-4 py-2 text-xs font-semibold text-gray-500 bg-gray-50 sticky top-0">${matches.length}ê°œ ì§€ì—­ ê²€ìƒ‰ë¨</div>`;
                const resultsList = matches.map(region => `
                    <div class="px-4 py-2 hover:bg-gray-100 cursor-pointer rounded-lg text-sm transition-colors" 
                         onclick="selectRegion('${region.Location}')">
                        <span class="font-medium text-gray-900">${region.Location}</span>
                        <span class="text-gray-500 text-xs ml-2">${clusterNames[region.cluster]}</span>
                    </div>
                `).join('');
                searchResults.innerHTML = countHeader + resultsList;
                searchResults.classList.remove('hidden');
            } else {
                searchResults.innerHTML = '<div class="px-4 py-2 text-sm text-gray-500">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</div>';
                searchResults.classList.remove('hidden');
            }
        });

        // ê²€ìƒ‰ ê²°ê³¼ ì„ íƒ
        let selectedRegionLocation = null;
        let scatterChartInstance = null;

        // ìŠ¤í¬ë¡¤ ê°€ëŠ¥í•œ ë©”ì¸ ì»¨í…Œì´ë„ˆ ì°¾ê¸°
        const mainScrollContainer = document.querySelector('main .overflow-y-auto');

        window.selectRegion = function(location) {
            selectedRegionLocation = location;
            document.getElementById('regionSelect').value = location;
            
            // ëª¨ë“  ì—…ë°ì´íŠ¸ ìˆ˜í–‰
            showRegionDetail(location);
            updateScatterChart();
            updateRankingTables();
            
            // ê²€ìƒ‰ì°½ ì´ˆê¸°í™”
            if (searchInput) searchInput.value = '';
            if (searchResults) searchResults.classList.add('hidden');
            
            // ë©”ì¸ ì»¨í…Œì´ë„ˆë¥¼ ìµœìƒë‹¨ìœ¼ë¡œ ìŠ¤í¬ë¡¤
            if (mainScrollContainer) {
                mainScrollContainer.scrollTo({ top: 0, behavior: 'smooth' });
            }
        };

        // ì „ì²´ ë³´ê¸° í•¨ìˆ˜
        function showAllRegions() {
            selectedRegionLocation = null;
            document.getElementById('dashboard').style.display = 'block';
            document.getElementById('regionDetail').style.display = 'none';
            updateScatterChart();
            updateRankingTables();
            
            // ìµœìƒë‹¨ìœ¼ë¡œ ìŠ¤í¬ë¡¤
            const mainScrollContainer = document.querySelector('main .overflow-y-auto');
            if (mainScrollContainer) {
                mainScrollContainer.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        // ìŠ¤í¬ë¡¤ í•¨ìˆ˜
        window.scrollToSection = function(sectionId) {
            if (event) event.preventDefault();
            
            const mainScrollContainer = document.querySelector('main .overflow-y-auto');
            
            // dashboard í´ë¦­ ì‹œ ì „ì²´ ë³´ê¸°ë¡œ ì „í™˜í•˜ê³  ìµœìƒë‹¨ìœ¼ë¡œ
            if (sectionId === 'dashboard') {
                if (document.getElementById('regionSelect').value !== 'all') {
                    document.getElementById('regionSelect').value = 'all';
                    showAllRegions();
                }
                // ë©”ì¸ ì»¨í…Œì´ë„ˆë¥¼ ìµœìƒë‹¨ìœ¼ë¡œ ìŠ¤í¬ë¡¤
                if (mainScrollContainer) {
                    mainScrollContainer.scrollTo({ top: 0, behavior: 'smooth' });
                }
            } else {
                // ë‹¤ë¥¸ ì„¹ì…˜ìœ¼ë¡œ ìŠ¤í¬ë¡¤
                const element = document.getElementById(sectionId);
                if (element && mainScrollContainer) {
                    const elementTop = element.offsetTop - mainScrollContainer.offsetTop;
                    mainScrollContainer.scrollTo({ top: elementTop - 20, behavior: 'smooth' });
                }
            }
            
            // ë©”ë‰´ í™œì„±í™” ìƒíƒœ ë³€ê²½
            document.querySelectorAll('.menu-link').forEach(link => {
                link.classList.remove('bg-indigo-50', 'text-indigo-700');
                link.classList.add('text-gray-600');
            });
            
            if (event && event.target) {
                const menuLink = event.target.closest('.menu-link');
                if (menuLink) {
                    menuLink.classList.add('bg-indigo-50', 'text-indigo-700');
                    menuLink.classList.remove('text-gray-600');
                }
            }
        };

        // ì§€ì—­ ì„ íƒ ì´ë²¤íŠ¸
        regionSelect.addEventListener('change', function() {
            const selectedRegion = this.value;
            if (selectedRegion === 'all') {
                showAllRegions();
            } else {
                selectedRegionLocation = selectedRegion;
                showRegionDetail(selectedRegion);
                updateScatterChart();
                updateRankingTables();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        });

        // íŠ¹ì • ì§€ì—­ ìƒì„¸ë³´ê¸° í•¨ìˆ˜
        function showRegionDetail(location) {
            const region = clusteredData.find(d => d.Location === location);
            if (!region) return;

            document.getElementById('dashboard').style.display = 'none';
            document.getElementById('regionDetail').style.display = 'block';

            // ì§€ì—­ ì •ë³´ ì—…ë°ì´íŠ¸
            document.getElementById('detailRegionName').textContent = location;
            document.getElementById('detailCluster').textContent = clusterNames[region.cluster];
            document.getElementById('detailClusterIcon').textContent = region.cluster === 0 ? 'ğŸŸ¢' : region.cluster === 1 ? 'ğŸŸ¡' : 'ğŸ”´';
            document.getElementById('detailInjuries').textContent = region.Injuries_1000.toFixed(2);
            document.getElementById('detailAccidents').textContent = region.Accidents_1000.toFixed(2);

            // ì „êµ­ í‰ê·  ëŒ€ë¹„
            const avgInjuries = clusteredData.reduce((sum, d) => sum + d.Injuries_1000, 0) / clusteredData.length;
            const diff = region.Injuries_1000 - avgInjuries;
            const diffPercent = (diff / avgInjuries * 100).toFixed(1);
            document.getElementById('detailDiff').textContent = diff >= 0 ? `+${diff.toFixed(2)}` : diff.toFixed(2);
            document.getElementById('detailDiffPercent').textContent = diff >= 0 ? `+${diffPercent}%` : `${diffPercent}%`;

            // ìˆœìœ„ ê³„ì‚°
            const sortedByInj = [...clusteredData].sort((a, b) => b.Injuries_1000 - a.Injuries_1000);
            const sortedByAcc = [...clusteredData].sort((a, b) => b.Accidents_1000 - a.Accidents_1000);
            const injuryRank = sortedByInj.findIndex(d => d.Location === location) + 1;
            const accidentRank = sortedByAcc.findIndex(d => d.Location === location) + 1;
            document.getElementById('detailInjuryRank').textContent = `${injuryRank}/${totalRegions}ìœ„`;
            document.getElementById('detailAccidentRank').textContent = `${accidentRank}/${totalRegions}ìœ„`;

            // ê°™ì€ í´ëŸ¬ìŠ¤í„° í‰ê· 
            const sameCluster = clusteredData.filter(d => d.cluster === region.cluster);
            const clusterAvgInj = sameCluster.reduce((sum, d) => sum + d.Injuries_1000, 0) / sameCluster.length;
            const clusterAvgAcc = sameCluster.reduce((sum, d) => sum + d.Accidents_1000, 0) / sameCluster.length;
            document.getElementById('clusterAvgInj').textContent = clusterAvgInj.toFixed(2);
            document.getElementById('clusterAvgAcc').textContent = clusterAvgAcc.toFixed(2);
            document.getElementById('avgInjuries').textContent = avgInjuries.toFixed(2);
            document.getElementById('avgAccidents').textContent = (clusteredData.reduce((sum, d) => sum + d.Accidents_1000, 0) / clusteredData.length).toFixed(2);
        }

        // Scatter Chart
        const ctxScatter = document.getElementById('scatterChart').getContext('2d');
        
        function createScatterData() {
            const datasets = [];

            // 1. ë¨¼ì € ì¼ë°˜ í´ëŸ¬ìŠ¤í„° ì ë“¤ ì¶”ê°€ (ë§¨ ì•„ë˜ ë ˆì´ì–´)
            datasets.push({
                label: 'Cluster 0 (Safe)',
                data: clusteredData.filter(d => d.cluster === 0 && d.Location !== selectedRegionLocation).map(d => ({
                    x: d.Injuries_1000, 
                    y: d.Accidents_1000,
                    label: d.Location
                })),
                backgroundColor: '#F97316',
                pointRadius: 4,
                pointHoverRadius: 6,
                order: 3  // ë‚®ì€ ìš°ì„ ìˆœìœ„
            });

            datasets.push({
                label: 'Cluster 1 (Caution)',
                data: clusteredData.filter(d => d.cluster === 1 && d.Location !== selectedRegionLocation).map(d => ({
                    x: d.Injuries_1000, 
                    y: d.Accidents_1000,
                    label: d.Location
                })),
                backgroundColor: '#3B82F6',
                pointRadius: 4,
                pointHoverRadius: 6,
                order: 3  // ë‚®ì€ ìš°ì„ ìˆœìœ„
            });

            datasets.push({
                label: 'Cluster 2 (Danger)',
                data: clusteredData.filter(d => d.cluster === 2 && d.Location !== selectedRegionLocation).map(d => ({
                    x: d.Injuries_1000, 
                    y: d.Accidents_1000,
                    label: d.Location
                })),
                backgroundColor: '#22C55E',
                pointRadius: 6,
                pointHoverRadius: 8,
                order: 3  // ë‚®ì€ ìš°ì„ ìˆœìœ„
            });

            // 2. ì¤‘ì‹¬ì  ì¶”ê°€ (ì¤‘ê°„ ë ˆì´ì–´)
            datasets.push({
                label: 'Centroids',
                data: centroids.map(c => ({
                    x: c.Injuries_1000,
                    y: c.Accidents_1000
                })),
                backgroundColor: '#000000',
                borderColor: '#000000',
                borderWidth: 3,
                pointRadius: 13,
                pointStyle: 'cross',
                pointHoverRadius: 16,
                order: 2  // ì¤‘ê°„ ìš°ì„ ìˆœìœ„
            });

            // 3. ì„ íƒëœ ì§€ì—­ì„ ë§¨ ë§ˆì§€ë§‰ì— ì¶”ê°€ (ìµœìƒìœ„ ë ˆì´ì–´)
            if (selectedRegionLocation) {
                const selectedRegion = clusteredData.find(d => d.Location === selectedRegionLocation);
                if (selectedRegion) {
                    datasets.push({
                        label: 'ì„ íƒëœ ì§€ì—­',
                        data: [{
                            x: selectedRegion.Injuries_1000,
                            y: selectedRegion.Accidents_1000,
                            label: selectedRegion.Location
                        }],
                        backgroundColor: '#FBBF24',  // ê¸ˆìƒ‰
                        borderColor: '#F59E0B',      // ì§„í•œ ê¸ˆìƒ‰ í…Œë‘ë¦¬
                        borderWidth: 5,
                        pointRadius: 12,
                        pointStyle: 'rectRot',       // ë‹¤ì´ì•„ëª¬ë“œ (45ë„ íšŒì „í•œ ì‚¬ê°í˜•) ğŸ’
                        pointHoverRadius: 16,
                        order: 1  // ìµœê³  ìš°ì„ ìˆœìœ„
                    });
                }
            }

            return { datasets };
        }

        function updateScatterChart() {
            if (scatterChartInstance) {
                scatterChartInstance.data = createScatterData();
                scatterChartInstance.update();
            }
        }

        scatterChartInstance = new Chart(ctxScatter, {
            type: 'scatter',
            data: createScatterData(),
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { 
                        display: true,
                        position: 'bottom',
                        labels: {
                            usePointStyle: true,
                            padding: 15,
                            filter: function(item, chart) {
                                return item.text !== 'Centroids';
                            }
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                if (context.dataset.label === 'Centroids') {
                                    return `ì¤‘ì‹¬ì : (${context.parsed.x.toFixed(2)}, ${context.parsed.y.toFixed(2)})`;
                                }
                                const point = context.raw;
                                return `${point.label}: (${context.parsed.x.toFixed(2)}, ${context.parsed.y.toFixed(2)})`;
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        title: { display: true, text: 'ë¶€ìƒììˆ˜ (1000ëª…ë‹¹)', font: { size: 12, weight: 'bold' } },
                        grid: { color: '#F3F4F6' }
                    },
                    y: {
                        title: { display: true, text: 'ì‚¬ê³ ê±´ìˆ˜ (1000ëª…ë‹¹)', font: { size: 12, weight: 'bold' } },
                        grid: { color: '#F3F4F6' }
                    }
                }
            }
        });

        // Bar Chart - í´ëŸ¬ìŠ¤í„°ë³„ í‰ê· 
        const avgCluster0 = clusteredData.filter(d => d.cluster === 0).reduce((sum, d) => sum + d.Injuries_1000, 0) / cluster0;
        const avgCluster1 = clusteredData.filter(d => d.cluster === 1).reduce((sum, d) => sum + d.Injuries_1000, 0) / cluster1;
        const avgCluster2 = clusteredData.filter(d => d.cluster === 2).reduce((sum, d) => sum + d.Injuries_1000, 0) / cluster2;

        const ctxBar = document.getElementById('barChart').getContext('2d');
        new Chart(ctxBar, {
            type: 'bar',
            data: {
                labels: ['ì•ˆì „ ì§€ì—­ (Cluster 0)', 'ì£¼ì˜ ì§€ì—­ (Cluster 1)', 'ìœ„í—˜ ì§€ì—­ (Cluster 2)'],
                datasets: [{
                    label: 'í‰ê·  ë¶€ìƒììˆ˜',
                    data: [avgCluster0, avgCluster1, avgCluster2],
                    backgroundColor: ['#F97316', '#3B82F6', '#22C55E'],
                    borderRadius: 8,
                    barThickness: 60
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: { color: '#F3F4F6' },
                        title: { display: true, text: 'í‰ê·  ë¶€ìƒììˆ˜ (1000ëª…ë‹¹)' }
                    },
                    x: { grid: { display: false } }
                }
            }
        });

        // ìˆœìœ„ í…Œì´ë¸” ìƒì„±
        const sortedByInjuries = [...clusteredData].sort((a, b) => b.Injuries_1000 - a.Injuries_1000);
        const sortedByAccidents = [...clusteredData].sort((a, b) => b.Accidents_1000 - a.Accidents_1000);
        
        const top10Injuries = sortedByInjuries.slice(0, 10);
        const bottom10Injuries = sortedByInjuries.slice(-10).reverse();
        const top10Accidents = sortedByAccidents.slice(0, 10);
        const bottom10Accidents = sortedByAccidents.slice(-10).reverse();

        function createTableRow(region, index, isTop, metric = 'injury') {
            const color = clusterColors[region.cluster];
            const rankColor = isTop ? (index < 3 ? 'rose' : 'gray') : (index < 3 ? 'emerald' : 'gray');
            const isSelected = selectedRegionLocation === region.Location;
            const highlightClass = isSelected ? 'bg-yellow-100 border-l-4 border-yellow-500' : '';
            
            if (metric === 'injury') {
                return `
                    <tr class="${highlightClass}">
                        <td class="text-center font-bold text-${rankColor}-600">${index + 1}</td>
                        <td>
                            <span class="cursor-pointer hover:text-indigo-600 hover:underline transition-colors ${isSelected ? 'font-extrabold text-indigo-700' : ''}" 
                                  onclick="selectRegion('${region.Location}')">
                                ${region.Location}${isSelected ? ' â­' : ''}
                            </span>
                        </td>
                        <td class="text-right font-medium">${region.Injuries_1000.toFixed(2)}</td>
                        <td class="text-right text-gray-500">${region.Accidents_1000.toFixed(2)}</td>
                        <td><span class="px-2 py-1 bg-${color}-100 text-${color}-700 text-xs rounded-full font-medium">${clusterNames[region.cluster]}</span></td>
                    </tr>
                `;
            } else {
                return `
                    <tr class="${highlightClass}">
                        <td class="text-center font-bold text-${rankColor}-600">${index + 1}</td>
                        <td>
                            <span class="cursor-pointer hover:text-indigo-600 hover:underline transition-colors ${isSelected ? 'font-extrabold text-indigo-700' : ''}" 
                                  onclick="selectRegion('${region.Location}')">
                                ${region.Location}${isSelected ? ' â­' : ''}
                            </span>
                        </td>
                        <td class="text-right font-medium">${region.Accidents_1000.toFixed(2)}</td>
                        <td class="text-right text-gray-500">${region.Injuries_1000.toFixed(2)}</td>
                        <td><span class="px-2 py-1 bg-${color}-100 text-${color}-700 text-xs rounded-full font-medium">${clusterNames[region.cluster]}</span></td>
                    </tr>
                `;
            }
        }

        function updateRankingTables() {
            // ë¶€ìƒììˆ˜ ìˆœìœ„ í…Œì´ë¸”
            document.getElementById('topRegionsTable').innerHTML = top10Injuries.map((r, i) => createTableRow(r, i, true, 'injury')).join('');
            document.getElementById('bottomRegionsTable').innerHTML = bottom10Injuries.map((r, i) => createTableRow(r, i, false, 'injury')).join('');
            
            // ì‚¬ê³ ê±´ìˆ˜ ìˆœìœ„ í…Œì´ë¸”
            document.getElementById('topAccidentsTable').innerHTML = top10Accidents.map((r, i) => createTableRow(r, i, true, 'accident')).join('');
            document.getElementById('bottomAccidentsTable').innerHTML = bottom10Accidents.map((r, i) => createTableRow(r, i, false, 'accident')).join('');
        }

        updateRankingTables();

    </script>
</body>
</html>
